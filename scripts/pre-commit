#!/bin/sh

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Define patterns that require documentation updates
# We look for changes in Controllers, Models, Dtos, Data, Services
CODE_CHANGES=$(echo "$STAGED_FILES" | grep -E "^(Controllers|Models|Dtos|Data|Services)/.*\.cs$")

# Check if ServerGuide.md is in the staged files
DOC_UPDATE=$(echo "$STAGED_FILES" | grep "^ServerGuide.md$")

if [ -n "$CODE_CHANGES" ] && [ -z "$DOC_UPDATE" ]; then
    echo "‚ùå  Error: You have modified backend code but 'ServerGuide.md' is not updated."
    echo "    Please update the documentation to reflect your changes."
    echo "    Staged code files:"
    echo "$CODE_CHANGES"
    echo ""
    echo "    If this change truly requires no doc update, use: git commit --no-verify"
    exit 1
fi

exit 0
